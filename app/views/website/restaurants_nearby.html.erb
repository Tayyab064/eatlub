<!-- SubHeader =============================================== -->
<section class="parallax-window" id="short" data-parallax="scroll" data-image-src="website/img/sub_header_short.jpg" data-natural-width="1400" data-natural-height="350">
    <div id="subheader">
	<div id="sub_content">
    	<h1> Searched results in your zone</h1>
        <div><i class="icon_pin"></i> <%= @address %> </div>
    </div><!-- End sub_content -->
</div><!-- End subheader -->
</section><!-- End section -->
<!-- End SubHeader ============================================ -->

<div id="position" class="hidden">
    <div class="container">
        <ul>
            <li><a href="<%= root_path %>">Home</a></li>
            <li><a href="#">Category</a></li>
            <li>Page active</li>
        </ul>
        <a href="grid_list.html#0" class="search-overlay-menu-btn"><i class="icon-search-6"></i> Search</a>
    </div>
</div><!-- Position -->

<div class="collapse" id="collapseMap">
	<div id="map" class="map"></div>
</div><!-- End Map -->

<!-- Content ================================================== -->
<div class="container margin_60_35">
	<div class="row">
    
		<div class="col-md-3">
			<p>
				<a id='view_on_map' class="btn_map" data-toggle="collapse" href="grid_list.html#collapseMap" aria-expanded="false" aria-controls="collapseMap">View on map</a>
			</p>
			<div id="filters_col">
				<a data-toggle="collapse" href="grid_list.html#collapseFilters" aria-expanded="false" aria-controls="collapseFilters" id="filters_col_bt">Filters <i class="icon-plus-1 pull-right"></i></a>
				<div class="collapse" id="collapseFilters">
					<div class="filter_type">
                    	<h6>Distance</h6>
                        <input type="text" id="range" value="" name="range">
						<h6>Type</h6>
						<ul>
							<li><label><input type="checkbox" checked class="icheck">All <small>(49)</small></label></li>
							<li><label><input type="checkbox" class="icheck">American <small>(12)</small></label><i class="color_1"></i></li>
							<li><label><input type="checkbox" class="icheck">Chinese <small>(5)</small></label><i class="color_2"></i></li>
							<li><label><input type="checkbox" class="icheck">Hamburger <small>(7)</small></label><i class="color_3"></i></li>
							<li><label><input type="checkbox" class="icheck">Fish <small>(1)</small></label><i class="color_4"></i></li>
							<li><label><input type="checkbox" class="icheck">Mexican <small>(49)</small></label><i class="color_5"></i></li>
							<li><label><input type="checkbox" class="icheck">Pizza <small>(22)</small></label><i class="color_6"></i></li>
							<li><label><input type="checkbox" class="icheck">Sushi <small>(43)</small></label><i class="color_7"></i></li>
						</ul>
					</div>
					<div class="filter_type">
						<h6>Rating</h6>
						<ul>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i><i class="icon_star"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i>
							</span></label></li>
							<li><label><input type="checkbox" class="icheck"><span class="rating">
							<i class="icon_star voted"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i>
							</span></label></li>
						</ul>
					</div>
					<div class="filter_type">
						<h6>Options</h6>
						<ul class="nomargin">
							<li><label><input type="checkbox" class="icheck">Delivery</label></li>
							<li><label><input type="checkbox" class="icheck">Take Away</label></li>
							<li><label><input type="checkbox" class="icheck">Distance 10Km</label></li>
							<li><label><input type="checkbox" class="icheck">Distance 5Km</label></li>
						</ul>
					</div>
				</div><!--End collapse -->
			</div><!--End filters col-->
		</div><!--End col-md -->
        
		<div class="col-md-9">
        
        	<div id="tools">
				<div class="row">
					<div class="col-md-3 col-sm-3 col-xs-6">
						<div class="styled-select">
							<select name="sort_rating" id="sort_rating">
								<option value="" selected>Sort by ranking</option>
								<option value="lower">Lowest ranking</option>
								<option value="higher">Highest ranking</option>
							</select>
						</div>
					</div>
					<div class="col-md-9 col-sm-9 hidden-xs">
						<a href="list_page.html" class="bt_filters"><i class="icon-list"></i></a>
					</div>
				</div>
			</div><!--End tools -->
        
        	<div class="row hidden">
            	<div class="col-md-6 col-sm-6 wow zoomIn" data-wow-delay="0.1s">
                	<a class="strip_list grid" href="detail_page.html">
                    	<div class="ribbon_1">Popular</div>
                    	<div class="desc">
							<div class="thumb_strip">
								<img src="website/img/thumb_restaurant.jpg" alt="">
							</div>
							<div class="rating">
								<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i>
							</div>
							<h3>Taco Mexican</h3>
							<div class="type">
								Mexican / American
							</div>
							<div class="location">
								135 Newtownards Road, Belfast, BT4. <br><span class="opening">Opens at 17:00.</span> Minimum order: $15
							</div>
							<ul>
								<li>Take away<i class="icon_check_alt2 ok"></i></li>
								<li>Delivery<i class="icon_check_alt2 ok"></i></li>
							</ul>
						</div>
                    </a><!-- End strip_list-->
                </div><!-- End col-md-6-->
               <div class="col-md-6 col-sm-6 wow zoomIn" data-wow-delay="0.2s">
                	<a class="strip_list grid" href="detail_page.html">
                    	<div class="ribbon_1">Popular</div>
                    	<div class="desc">
							<div class="thumb_strip">
								<img src="website/img/thumb_restaurant_2.jpg" alt="">
							</div>
							<div class="rating">
								<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i>
							</div>
							<h3>Naples Pizza</h3>
							<div class="type">
								Italian / Pizza
							</div>
							<div class="location">
								135 Newtownards Road, Belfast, BT4. <br><span class="opening">Opens at 17:00.</span> Minimum order: $15
							</div>
							<ul>
								<li>Take away<i class="icon_check_alt2 ok"></i></li>
								<li>Delivery<i class="icon_check_alt2 ok"></i></li>
							</ul>
						</div>
                    </a><!-- End strip_list-->
                </div><!-- End col-md-6-->                
            </div><!-- End row-->
            
            <div class="row hidden">
            	<div class="col-md-6 col-sm-6 wow zoomIn" data-wow-delay="0.3s">
                	<a class="strip_list grid" href="detail_page.html">
                    	<div class="ribbon_1">Popular</div>
                    	<div class="desc">
							<div class="thumb_strip">
								<img src="website/img/thumb_restaurant_3.jpg" alt="">
							</div>
							<div class="rating">
								<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i>
							</div>
							<h3>Japan Food</h3>
							<div class="type">
								Sushi / Japanese
							</div>
							<div class="location">
								135 Newtownards Road, Belfast, BT4. <br><span class="opening">Opens at 17:00.</span> Minimum order: $15
							</div>
							<ul>
								<li>Take away<i class="icon_check_alt2 ok"></i></li>
								<li>Delivery<i class="icon_check_alt2 ok"></i></li>
							</ul>
						</div>
                    </a><!-- End strip_list-->
                </div><!-- End col-md-6-->
                <div class="col-md-6 col-sm-6 wow zoomIn" data-wow-delay="0.4s">
                	<a class="strip_list grid" href="detail_page.html">
                    	<div class="desc">
							<div class="thumb_strip">
								<img src="website/img/thumb_restaurant_4.jpg" alt="">
							</div>
							<div class="rating">
								<i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i>
							</div>
							<h3>Sushi Gold</h3>
							<div class="type">
								Sushi / Japanese
							</div>
							<div class="location">
								135 Newtownards Road, Belfast, BT4. <br><span class="opening">Opens at 17:00.</span> Minimum order: $15
							</div>
							<ul>
								<li>Take away<i class="icon_check_alt2 ok"></i></li>
								<li>Delivery<i class="icon_check_alt2 ok"></i></li>
							</ul>
						</div>
                    </a><!-- End strip_list-->
                </div><!-- End col-md-6-->                
            </div><!-- End row-->
            <% @restaurants.each_with_index do |rest,index| %>
            	<% if (index % 2) == 0  %>
            	<div class="row">
            	<% end %>
	            	<div class="col-md-6 col-sm-6 wow zoomIn" data-wow-delay="0.5s">
	                	<a class="strip_list grid" href="restaurant_<%= rest.id %>">
	                	<div class="<%= rest.popular ? 'ribbon_1' : '' %>"></div>
	                    	<div class="desc">
								<div class="thumb_strip">
									<img src="<%= rest.image_url.present? ? rest.image_url : 'website/img/thumb_restaurant.jpg' %>" alt="">
								</div>
								<div class="rating">
								<% if rest.reviews.count > 0 %>
		                            <% t_rat = ( rest.reviews.pluck("SUM(rating)").first.to_f / rest.reviews.count ).round %>
		                            <% t_rat.times do |th| %>
		                            <i class="icon_star voted"></i>
		                            <% end %>
		                            <% (5-t_rat).times do |th| %>
		                            <i class="icon_star"></i>
		                            <% end %>
		                        <% else %>
		                            <i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i>
		                        <% end %>
								</div>
								<h3> <%= rest.name %> </h3>
								<div class="type">
									<%= rest.cuisine %>
								</div>
								<div class="location">
									<%= rest.location %> <br><span class="opening">Opens at <%= rest.opening_time.strftime("%R") %>.</span> Minimum order: $15
								</div>
								<ul>
									<li>Take away<i class="icon_check_alt2 ok"></i></li>
									<li>Delivery<i class="icon_check_alt2 ok"></i></li>
								</ul>
							</div>
	                    </a><!-- End strip_list-->
	                </div><!-- End col-md-6-->
                <% if (index % 2) != 0  %>
            	</div>
            	<% end %>
            <% end %>
            <!-- <a href="grid_list.html#0" class="load_more_bt wow fadeIn" data-wow-delay="0.2s">Load more...</a>   -->         
		</div><!-- End col-md-9-->
        
	</div><!-- End row -->
</div><!-- End container -->
<!-- End Content =============================================== -->
<% my_lat_long = Geocoder.coordinates(@address) %>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyBoUyblkGqwp2lFuWQb0v_-J_mI5sYJYPc" type="text/javascript"></script>

<script type="text/javascript">
  /* ============================================================
 * Google Map
 * Render maps using Google Maps JS API
 * For DEMO purposes only. Extract what you need.
 * ============================================================ */
(function($) {

    'use strict';

    var initmapre = document.getElementById('view_on_map');

    // When the window has finished loading create our google map below
    google.maps.event.addDomListener(initmapre, 'click', init);

    var map;
    var zoomLevel = 13;

    function init() {
        // Basic options for a simple Google Map
        // For more options see: https://developers.google.com/maps/documentation/javascript/reference#MapOptions

        // Get the HTML DOM element that will contain your map 
        // We are using a div with id="map" seen below in the <body>
        var mapElement = document.getElementById('map');

        // Create the Google Map using out element and options defined above
        map = new google.maps.Map(mapElement, {
          center: {lat: <%= my_lat_long.present? ? my_lat_long.first : '51.5074' %>, lng: <%= my_lat_long.present? ? my_lat_long.last : '0.1278' %>},
          scrollwheel: false,
          zoom: zoomLevel
        });

        var locations = [];
        <% @restaurants.each do |res| %>
        locations.push(['<%= res.name %>', <%= res.latitude %>, <%= res.longitude %>, '<%= res.location %>']);
        <% end %>
        var infowindow = new google.maps.InfoWindow();

        var marker, i;

        for (i = 0; i < locations.length; i++) {  
          marker = new google.maps.Marker({
            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
            map: map
          });

          /*icon: 'http://image.flaticon.com/icons/svg/67/67994.svg',*/

          google.maps.event.addListener(marker, 'mouseover', (function(marker, i) {
            return function() {
              infowindow.setContent(locations[i][0]);
              infowindow.open(map, marker);
            }
          })(marker, i));

          google.maps.event.addListener(marker, 'mouseout', (function(marker, i) {
            return function() {
              infowindow.close();
            }
          })(marker, i));
        }
    }

})(window.jQuery);

</script>