<!-- SubHeader =============================================== -->
<section class="parallax-window" data-parallax="scroll" data-image-src="website/img/sub_header_2.jpg" data-natural-width="1400" data-natural-height="470">
    <div id="subheader">
		<div id="sub_content">
	    	<div id="thumb"><img src="website/img/thumb_restaurant.jpg" alt=""></div>
	                     <div class="rating"><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star voted"></i><i class="icon_star"></i> (<small><a href="detail_page_2.html">Read 98 reviews</a></small>)</div>
	                    <h1><%= @restaurant.name %></h1>
	                    <div><em><%= @restaurant.cuisine %></em></div>
	                    <div><i class="icon_pin"></i> <%= @restaurant.location %> - <strong>Delivery charge:</strong> $10, free over $15.</div>
	    </div><!-- End sub_content -->
	</div><!-- End subheader -->
</section><!-- End section -->
<!-- End SubHeader ============================================ -->

    <div id="position">
        <div class="container">
            <ul>
                <li><a href="<%= root_path %>">Home</a></li>
                <li><a href="#">Category</a></li>
                <li>Page active</li>
            </ul>
            <a href="#" class="search-overlay-menu-btn"><i class="icon-search-6"></i> Search</a>
        </div>
    </div><!-- Position -->

<!-- Content ================================================== -->
<div class="container margin_60_35">
		<div class="row">
        
			<div class="col-md-3">
            	<p><a href="restaurant_<%= @restaurant.id %>" class="btn_side">Back to restaurant</a></p>
				<div class="box_style_1">
					<ul id="cat_nav">
                        <% if @restaurant.menu.present? %>
                          <% menu = @restaurant.menu %>
                          <% menu.sections.each_with_index do |sec,index| %>
                            <% if index == 0 %>
						      <li><a href="#<%= sec.title %>" class="active"><%= sec.title.capitalize %> <span>(<%= sec.food_items.count %>)</span></a></li>
                            <% else %>
                            <li><a href="#<%= sec.title %>" class=""><%= sec.title.capitalize %> <span>(<%= sec.food_items.count %>)</span></a></li>
                            <% end %>
                          <% end %>
                        <% else %>
                            <li><a class="">Menu <span>(0)</span></a></li>
						<% end %>
					</ul>
				</div><!-- End box_style_1 -->
                
				<div class="box_style_2 hidden-xs" id="help">
					<i class="icon_lifesaver"></i>
					<h4>Need <span>Help?</span></h4>
					<a href="tel://004542344599" class="phone">+45 423 445 99</a>
					<small>Monday to Friday 9.00am - 7.30pm</small>
				</div>
			</div><!-- End col-md-3 -->
            
			<div class="col-md-6">
				<div class="box_style_2" id="main_menu">
					<h2 class="inner">Menu</h2>
                    <% if menu.present? %>
                        <% menu.sections.each_with_index do |sec,index| %>
                        <% if index == 0 %>
        					<h3 class="nomargin_top" id="<%= sec.title %>"><%= sec.title %></h3>
                        <% else %>
        					<hr>
        					<h3 id="<%= sec.title %>"><%= sec.title %></h3>
                        <% end %>
                        <p>
                            Te ferri iisque aliquando pro, posse nonumes efficiantur in cum. Sensibus reprimique eu pro. Fuisset mentitum deleniti sit ea.
                        </p>
                        <table class="table table-striped cart-list">
                            <thead>
                                <tr>
                                    <th>
                                         Item
                                    </th>
                                    <th>
                                         Price
                                    </th>
                                    <th>
                                         Order
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <% sec.food_items.each_with_index do |food,ind| %>
                                <tr>
                                    <td>
                                        <figure class="thumb_menu_list"><img src="<%= food.image.present? ? food.image_url : 'website/img/menu-thumb-1.jpg' %>" alt="thumb"></figure>
                                        <h5 id='food_ti_<%= food.id %>'><%= ind +1 %>. <%= food.name %></h5>
                                        <p>
                                            Fuisset mentitum deleniti sit ea.
                                        </p>
                                    </td>
                                    <td>
                                        <strong id='food_pr_<%= food.id %>'>€ <%= food.price %></strong>
                                    </td>
                                    <td class="options">
                                        <div class="dropdown dropdown-options">
                                            <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true"><i class="icon_plus_alt2"></i></a>
                                            <div class="dropdown-menu">
                                                <h5>Select an option</h5>
                                                <label>
                                                <input type="radio" value="option1" name="options_1" checked>Medium <span>+ $3.30</span>
                                                </label>
                                                <label>
                                                <input type="radio" value="option2" name="options_1" >Large <span>+ $5.30</span>
                                                </label>
                                                <label>
                                                <input type="radio" value="option3" name="options_1" >Extra Large <span>+ $8.30</span>
                                                </label>
                                                <h5>Add ingredients</h5>
                                                <label>
                                                <input type="checkbox" value="">Extra Tomato <span>+ $4.30</span>
                                                </label>
                                                <label>
                                                <input type="checkbox" value="">Extra Peppers <span>+ $2.50</span>
                                                </label>
                                                <a class="add_to_basket" onclick="add_cart(<%= food.id %>);">Add to cart</a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <% end %>
                            </tbody>
                        </table>
                        <% end %>
                    <% else %>
                        <h3 >detail missing</h3>
                    <% end %>
				</div><!-- End box_style_1 -->
			</div><!-- End col-md-6 -->
            
			<div class="col-md-3" id="sidebar">
            <div class="theiaStickySidebar">
				<div id="cart_box" >
					<h3>Your order <i class="icon_cart_alt pull-right"></i></h3>
					<table class="table table_summary">
					<tbody id='mycarti'>
						
					</tbody>
					</table>
					<hr>
					<div class="row" id="options_2">
						<div class="col-lg-6 col-md-12 col-sm-12 col-xs-6">
							<label><input type="radio" value="" checked name="option_2" class="icheck">Delivery</label>
						</div>
						<div class="col-lg-6 col-md-12 col-sm-12 col-xs-6">
							<label><input type="radio" value="" name="option_2" class="icheck">Take Away</label>
						</div>
					</div><!-- Edn options 2 -->
                    
					<hr>
					<table class="table table_summary">
					<tbody>
						<tr>
							<td>
								 Subtotal <span class="pull-right tot_price">$0</span>
							</td>
						</tr>
						<tr>
							<td>
								 Delivery fee <span class="pull-right">$0</span>
							</td>
						</tr>
						<tr>
							<td class="total">
								 TOTAL <span class="pull-right tot_price">$0</span>
							</td>
						</tr>
					</tbody>
					</table>
					<hr>
					<a class="btn_full" href="cart.html">Order now</a>
				</div><!-- End cart_box -->
                </div><!-- End theiaStickySidebar -->
			</div><!-- End col-md-3 -->
            
		</div><!-- End row -->
</div><!-- End container -->

<script type="text/javascript">

	window.onload = function(e){
		coun = parseInt(window.localStorage.getItem('count'));
		var tot_pri = 0.0 ;
		console.log('Fetching');

		da = '';
		for(i = 0; i < coun; i++){
            if(window.localStorage.getItem('carti[' + i + ']')){
               t = JSON.parse(window.localStorage.getItem('carti[' + i + ']'));
               da = da + "<tr><td><a onclick='remove_cart(" + i + ")' class='remove_item'><i class='icon_minus_alt'></i></a> <strong>1x</strong> "+ t.title +"</td><td><strong class='pull-right'>$"+ t.price +"</strong></td></tr>";
               tot_pri = tot_pri + t.price ;
            }
        }

        document.getElementById("mycarti").innerHTML = da ;
        document.getElementsByClassName("tot_price")[0].innerHTML = '$' + tot_pri.toFixed(2);
        document.getElementsByClassName("tot_price")[1].innerHTML = '$' + tot_pri.toFixed(2);
	}


	function add_cart(i) {
		coun = 0;

		if(window.localStorage.getItem('count')){
			coun = parseInt(window.localStorage.getItem('count'));
		}else{
			window.localStorage.setItem('count', 0);
		}
		

	    var titl = document.getElementById("food_ti_"+i).textContent.replace(/(\d+.\s)/, "");
	    var pric = parseFloat(document.getElementById("food_pr_"+i).textContent.replace(/(€ )/, ""));
	    console.log(titl + " " + pric);

	    window.localStorage.setItem('carti['+ coun +']', JSON.stringify({id:i, title: titl, price: pric}));
		
		coun = coun + 1;
		window.localStorage.setItem('count', coun);

        $.ajax({
           url: 'http://138.197.117.248/ajax',
           success: function(data) {
                coun = parseInt(window.localStorage.getItem('count'));
                var tot_pri = 0.0 ;
                console.log('Fetching');

                da = '';
                for(i = 0; i < coun; i++){
                   if(window.localStorage.getItem('carti[' + i + ']')){
                       t = JSON.parse(window.localStorage.getItem('carti[' + i + ']'));
                       da = da + "<tr><td><a onclick='remove_cart(" + i + ")' class='remove_item'><i class='icon_minus_alt'></i></a> <strong>1x</strong> "+ t.title +"</td><td><strong class='pull-right'>$"+ t.price +"</strong></td></tr>";
                       tot_pri = tot_pri + t.price ;
                    }
                }

                document.getElementById("mycarti").innerHTML = da ;
                document.getElementsByClassName("tot_price")[0].innerHTML = '$' + tot_pri.toFixed(2);
                document.getElementsByClassName("tot_price")[1].innerHTML = '$' + tot_pri.toFixed(2);
           }
        });

	}

    function remove_cart(i) {
        if(window.localStorage.getItem('carti[' + i + ']')){
            localStorage.removeItem('carti[' + i + ']');

            
            $.ajax({
               url: 'http://138.197.117.248/ajax',
               success: function(data) {
                    coun = parseInt(window.localStorage.getItem('count'));
                    var tot_pri = 0.0 ;
                    console.log('Fetching');

                    da = '';
                    for(i = 0; i < coun; i++){
                       if(window.localStorage.getItem('carti[' + i + ']')){
                           t = JSON.parse(window.localStorage.getItem('carti[' + i + ']'));
                           da = da + "<tr><td><a onclick='remove_cart(" + i + ")' class='remove_item'><i class='icon_minus_alt'></i></a> <strong>1x</strong> "+ t.title +"</td><td><strong class='pull-right'>$"+ t.price +"</strong></td></tr>";
                           tot_pri = tot_pri + t.price ;
                       }
                    }

                    document.getElementById("mycarti").innerHTML = da ;
                    document.getElementsByClassName("tot_price")[0].innerHTML = '$' + tot_pri.toFixed(2);
                    document.getElementsByClassName("tot_price")[1].innerHTML = '$' + tot_pri.toFixed(2);
               }
            });

        }else{
            console.log('Finding');
        }
    }


</script>